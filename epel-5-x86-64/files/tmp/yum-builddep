#!/bin/bash
set -ex
case $1 in
    *.src.rpm)
        pushd $(mktemp -d)
        rpm2cpio $1 | cpio -iv --make-directories '*.spec'
        BUILDREQUIRES=$(/tmp/parse-spec-build-requires.pl $(ls *.spec))
        popd
        ;;
    *.spec)
        BUILDREQUIRES=$(/tmp/parse-spec-build-requires.pl $1)
        ;;
    *)
        echo "unrecognized extension in filename $1"
        exit 1
        ;;
esac
SHOULDINSTALL=""
for v in ${BUILDREQUIRES}
do
    { yum info ${v} > /dev/null && PACKAGE=${v} ; } || PACKAGE=$(repoquery --arch=$(arch) --whatprovides ${v})
    SHOULDINSTALL="${SHOULDINSTALL} ${PACKAGE}"
done
SHOULDINSTALL=$(echo -n ${SHOULDINSTALL} | sed -e 's/^ *//' -e 's/ *$//')
{ [ -n "${SHOULDINSTALL}" ] && yum install $SHOULDINSTALL ; } || /bin/true
